# node æž„å»º
FROM node:18-alpine as build-stage

WORKDIR /app
COPY . ./
# è®¾ç½® node é˜¿é‡Œé•œåƒ
RUN npm config set registry https://registry.npmmirror.com/
# è®¾ç½®--max-old-space-size
ENV NODE_OPTIONS=--max-old-space-size=16384

RUN npm install pnpm -g && \
    pnpm install --frozen-lockfile && \
    pnpm build:docker

RUN echo "ðŸŽ‰ æ‰“åŒ…æˆåŠŸ ðŸŽ‰"

FROM nginx:stable-alpine as production-stage

ENV TZ=Asia/Shanghai

# set timezone
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo '$TZ' > /etc/timezone

COPY --from=build-stage /app/dist /usr/share/nginx/html
COPY ./nginx.conf /etc/nginx/nginx.conf
